# Docker Storage Drivers (–¥—Ä–∞–π–≤–µ—Ä—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è)

`Docker` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **storage drivers** (–¥—Ä–∞–π–≤–µ—Ä—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å–ª–æ—ë–≤ –æ–±—Ä–∞–∑–æ–≤ –∏ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. **performance** (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å), **stability** (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å) –∏ **compatibility** (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å).

## –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ storage drivers

- **Docker-–æ–±—Ä–∞–∑—ã** —Å–æ—Å—Ç–æ—è—Ç –∏–∑ `read-only` (—Å–ª–æ—ë–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è).
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ–≤–µ—Ä—Ö –Ω–∏—Ö —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–Ω–∫–∏–π **writable layer** (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π —Å–ª–æ–π).
- **Storage driver** —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º —ç—Ç–∏—Ö —Å–ª–æ—ë–≤: union mount (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ–º), copy-on-write (–∑–∞–ø–∏—Å—å—é) –∏ deletion (—É–¥–∞–ª–µ–Ω–∏–µ–º).

## –ö–ª—é—á–µ–≤—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã

### 1. **`overlay2`** ‚úÖ

- **–°—Ç–∞—Ç—É—Å**: –¥—Ä–∞–π–≤–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: Overlay File System (–º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞).
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
  - –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ inodes (index node - –∏–Ω–¥–µ–∫—Å–Ω—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä)
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 128 —Å–ª–æ—ë–≤
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è production.

### 2. **`aufs`** ‚ö†Ô∏è

- **–°—Ç–∞—Ç—É—Å**: legacy (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π).
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è**: Advanced Multi-Layered Unification Filesystem (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞).
- **–ü—Ä–æ–±–ª–µ–º—ã**:
  - –ù–µ –≤—Ö–æ–¥–∏—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ —è–¥—Ä–æ Linux
  - –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ inodes (index node - –∏–Ω–¥–µ–∫—Å–Ω—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä)
  - –ú–µ–¥–ª–µ–Ω–Ω–µ–µ overlay2
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏.

### 3. **`btrfs`** üîä

- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ btrfs –Ω–∞ —Ö–æ—Å—Ç–µ.
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Snapshots (–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–Ω–∞–ø—à–æ—Ç—ã)
  - Compression (–∫–æ–º–ø—Ä–µ—Å—Å–∏—è –¥–∞–Ω–Ω—ã—Ö)
  - Checksums (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –∫–æ–≥–¥–∞ –Ω—É–∂–Ω—ã –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.

### 4. **`zfs`** üîä

- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ ZFS –Ω–∞ —Ö–æ—Å—Ç–µ.
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Copy-on-write (–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏)
  - Data Deduplication (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
  - Snapshots and Cloning (—Å–Ω–∞–ø—à–æ—Ç—ã –∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –¥–ª—è enterprise-—Å–∏—Å—Ç–µ–º —Å –≤—ã—Å–æ–∫–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –∫ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏.

### 5. **`devicemapper`** ‚ö†Ô∏è

- **–°—Ç–∞—Ç—É—Å**: —É—Å—Ç–∞—Ä–µ–≤—à–∏–π (deprecated).
- **–†–µ–∂–∏–º—ã**:
  - `loop-lvm` - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–º–µ–¥–ª–µ–Ω–Ω—ã–π)
  - `direct-lvm` - –¥–ª—è production (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- **–ü—Ä–æ–±–ª–µ–º—ã**: —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ç–µ—á–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.

### 6. **`vfs`** üêå

- **–ü—Ä–∏–Ω—Ü–∏–ø**: –ø–æ–ª–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏.
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**: –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω—ã–π, –≤—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –¥–∏—Å–∫–∞.
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã storage-–ø–æ–¥—Å–∏—Å—Ç–µ–º—ã.

## Copy-on-Write (CoW) –º–µ—Ö–∞–Ω–∏–∑–º

**–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã**:

- –§–∞–π–ª—ã —á–∏—Ç–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –Ω–∏–∂–Ω–∏—Ö (–æ–±—Ä–∞–∑–Ω—ã—Ö) —Å–ª–æ—ë–≤
- –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ–∞–π–ª –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –≤–µ—Ä—Ö–Ω–∏–π (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã–π) —Å–ª–æ–π
- –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –∫–æ–ø–∏–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:

- –≠–∫–æ–Ω–æ–º–∏—è –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –ë—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ò–∑–æ–ª—è—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –¢–µ–∫—É—â–∏–π –¥—Ä–∞–π–≤–µ—Ä

```bash
docker info | grep -A5 "Storage Driver"
```

### –°–º–µ–Ω–∞ –¥—Ä–∞–π–≤–µ—Ä–∞

–í `/etc/docker/daemon.json`:

```json
{
  "storage-driver": "overlay2",
  "storage-opts": ["overlay2.override_kernel_check=true"]
}
```

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker:

```bash
sudo systemctl restart docker
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É

| –°—Ü–µ–Ω–∞—Ä–∏–π                        | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –¥—Ä–∞–π–≤–µ—Ä     |
| ------------------------------- | ------------------------- |
| **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Linux**           | `overlay2`                |
| **–í—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º** | `zfs` –∏–ª–∏ `btrfs`         |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/–æ—Ç–ª–∞–¥–∫–∞**        | `vfs`                     |
| **–°—Ç–∞—Ä—ã–µ —Å–∏—Å—Ç–µ–º—ã**              | `aufs` –∏–ª–∏ `devicemapper` |

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ –º–µ–Ω—è–π—Ç–µ –¥—Ä–∞–π–≤–µ—Ä –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏** - —ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö
2. **–î—Ä–∞–π–≤–µ—Ä –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏** –æ–±—Ä–∞–∑–æ–≤ –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
3. **–†–∞–∑–Ω—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã –∏–º–µ—é—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤, —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤)
4. **Production-—Å—Ä–µ–¥—ã —Ç—Ä–µ–±—É—é—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥—Ä–∞–π–≤–µ—Ä–∞

**–ò—Ç–æ–≥**: –î–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ `overlay2` - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –±–∞–ª–∞–Ω—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

---
